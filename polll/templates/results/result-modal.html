{% import 'macros.jinja' as macs %}

<div class="flex flex-col fixed justify-center items-center w-screen h-dvh md:h-screen z-10 text-neutral-700 dark:text-neutral-200">

  <div class="flex flex-col size-11/12 rounded-xl border-2 bg-polll-white dark:bg-neutral-900 border-neutral-300 dark:border-neutral-700 px-6 py-4">

    <!-- Close Modal -->
    <div class="flex">
      <a
        href="{{ return_url }}"
        hx-indicator="#loading-spinner"
        class="px-2 py-0.5 w-fit text-center text-3xl rounded-md hover:dark:bg-neutral-600"
      >
        &times;
      </a>
    </div>

    <!-- Modal Content -->
    <div id="test" class="flex flex-row grow size-11/12 justify-center items-start p-2">

        <div class="flex flex-col w-3/5 h-full p-4 border-r border-r-neutral-500">

            <!-- Include the poll question -->
            <div class="flex flex-row w-full px-4">
                <p class="font-light text-2xl text-neutral-700 dark:text-neutral-200">
                  {{ session.viewed_poll.question }}
                </p>
            </div>

            <!-- Poll Results -->             
            <div id="poll-graph-modal-{{ session.viewed_poll.id }}">
                {% if session.viewed_poll.poll_type == "RANKED_POLL" %}
                    {% include "results/ranked-poll.html" %}
                {% elif session.viewed_poll.poll_type == "TIER_LIST" %}
                    {% include "results/tier-list.html" %}
                {% endif %} 
            </div>
            

            <!-- Poll Actions -->
            <div class="flex flex-row">

                <!-- Votes -->
                <p class="font-light">
                    Votes: {{ session.viewed_poll.response_count }}
                </p>

                <!-- Share Button -->
                <button 
                class="ml-auto text-l md:text-xl rounded-md hover:cursor-default text-right"
                title="Share"
                onclick="copy_link('{{ poll.url }}')"
                type="button"
                >
                    <i class="fa fa-share-from-square hover:text-polll-dgreen dark:hover:text-polll-green"></i>
                </button>
                
                <!-- Report Button -->
                <button
                class="ml-3 md:ml-6 text-l md:text-xl rounded-md hover:text-polll-red text-right"
                title="Report"
                hx-post="{{ url_for('poll.report', poll_id = poll.id) }}"
                hx-confirm="Are you sure you want to report this poll?"
                hx-swap="none"
                type="button"
                >
                    <i class="fa fa-triangle-exclamation"></i>
              </button>

            </div>

        </div>


        <!-- Comments/User results -->
        <div class="flex flex-col w-2/5 h-full p-2 overflow-y-scroll">

            <!-- Poll Creator + Age -->
            <div class="flex flex-row w-full p-4 border-b border-b-neutral-500">
                
                <div class="flex flex-row grow">
                    <p class="font-light text-xl text-neutral-500 dark:text-neutral-400">
                        {% if session.viewed_poll.is_anonymous == 1 %}
                          anonymous
                        {% else %}
                          @{{ session.viewed_poll.creator }}
                        {% endif %} â‹… {{ session.viewed_poll.age }}
                      </p>  
                </div>

                <div>
                    {{ macs.toggleButton("comment-voter-results-toggle-" + poll.id|string, "toggle_comment_user_results", "Comments") }}
                </div>

            </div>

            <!-- Comment section -->
            <div class="grow p-4 overflow-y-scroll">
                <div id="poll-comments-modal-{{ poll.id }}" class="poll-comments px-2 py-1 h-full">
                    {% with %}
                        {% set inModal = True %}
                        {% include "results/poll-comments.html" %}
                    {% endwith %}
                </div>
                <div id="voter-results-modal-{{ poll.id }}" class="hidden px-2 py-1 h-full">
                    {% with %}
                        {% set inModal = True %}
                        {% include "results/voter-results.html" %}
                    {% endwith %}
                </div>
            </div>
            
            <!-- Comment input box -->
            <div id="poll-comments-input-modal-{{ poll.id }}" class="p-2">
                <div class="flex flex-row items-center {% if inModal %} hidden {% endif %}">
                    <input class="grow text-l p-2 bg-transparent border-b border-neutral-700 dark:text-white focus:outline-none font-light" 
                      autocomplete="off"
                      name="comment"
                      placeholder="Add a comment..."
                      id="comment-input-{{ poll.id }}"
                    />
                    <button class="ml-2 px-4 h-6 md:h-8 rounded-xl text-neutral-900 bg-neutral-300 hover:bg-white"
                      hx-include="previous input"
                      hx-post="{{ url_for('poll.create_comment', poll_id = poll.id) }}"
                      hx-target="#comments-list-{{ poll.id }}"
                      hx-swap="afterbegin"
                    >
                      <span class="hidden text-sm md:inline mr-1">Send</span>
                      <i class="fa fa-paper-plane"></i>
                    </button>
                  </div>
            </div>
        </div>

    </div>

</div>

</div>

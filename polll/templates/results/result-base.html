<div 
  id="poll-card-{{ poll.id }}"
  class="poll-card rounded-xl border mb-2 md:mb-4 dark:border-neutral-700 dark:hover:border-neutral-200 overflow-hidden accord-open transition-all duration-500 ease-in-out"
>    
  <!-- Include the creator's username and the poll age -->
  <div class="flex flex-row justify-center items-center pt-4 px-4 h-10">
    <p class="font-light text-neutral-500 dark:text-neutral-400">
      {% if poll.is_anonymous == 1 %}
        anonymous
      {% else %}
        @{{ poll.creator }}
      {% endif %} â‹… {{ poll.age }}
    </p>

    <!-- Share Button -->
    <button 
      class="ml-auto text-l md:text-xl rounded-md hover:cursor-default text-right"
      title="Share"
      onclick="copy_link('{{ poll.url }}')"
      type="button"
    >
      <i class="fa fa-share-from-square text-xs hover:text-polll-dgreen dark:hover:text-polll-green">
      </i>
    </button>

    <!-- If the user created this poll, allow them to edit it -->
    {% if session.user.id == poll.creator_id %}

      <!-- Toggle Lock -->
      {% with %}
        {% set id=poll.id %}
        {% set is_active=poll.is_active %}
        {% include "results/poll-lock.html" %}
      {% endwith %}

      <!-- If the user is an administrator, allow them to pin this poll -->
      {% if session.user.is_admin %}

        {% with %}
          {% set id=poll.id %}
          {% set is_pinned=poll.is_pinned %}
          {% include "results/poll-pin.html" %}
        {% endwith %}

      {% endif %}
      
      <!-- Delete Poll -->
      <input class="hidden" name="poll_id" value="{{ poll.id }}">
      <button class="ml-3 md:ml-6 text-l md:text-xl rounded-md hover:cursor-default text-right"
          title="Delete"
          hx-get="{{ url_for('poll.delete', poll_id = poll.id) }}"
          hx-include="previous input"
          hx-target="#poll-card-{{ poll.id }}"
          hx-swap="delete"
          hx-confirm="Are you sure you want to delete this poll?">
        <i class="fa fa-trash text-xs hover:text-polll-red"></i>
      </button>

    <!-- If the user didn't create this poll, allow them to report it -->
    {% else %}

      <button
        class="ml-3 md:ml-6 text-l md:text-xl rounded-md hover:text-polll-red text-right"
        title="Report"
        hx-post="{{ url_for('poll.report', poll_id = poll.id) }}"
        hx-confirm="Are you sure you want to report this poll?"
        hx-swap="none"
        type="button"
      >
        <i class="fa fa-triangle-exclamation text-xs"></i>
      </button>

      {% with %}
        {% set user_id=session.user.id %}
        {% set poll_id=poll.id %}      
        {#
        PROBLEM: This is wrong because 'polls_answered' are the polls answered by the user currently
        being viewed, but the favourite should be for all polls, and if the poll_id refers 
        to a poll that the viewed user did not vote on, this will throw an error. 

        SOLUTION: Since favouriting is for the personal user, index the polls that the logged in user has
                  voted on, and not the viewed one (that is currently being use here, which is 'polls_answerd')

        {% set is_favourited=session.polls_answered[poll_id].is_favourited %}
        #}
        {% include "results/poll-favourite.html" %}
      {% endwith %}

    {% endif %}

  </div>

  <!-- Include the poll question -->
  <!-- NOTE: We put this in a separate row because it displays better on mobile -->
  <div class="flex flex-row w-full px-4">
    <p class="font-light text-neutral-700 dark:text-neutral-200 text-2xl">
      {{ poll.question }}
    </p>
  </div>

  <!-- Poll Graph -->
  <div id="poll-graph-{{ poll.id }}" class="p-2 md:px-8 md:py-4 fade-in">
    <!-- Separate Interfaces for Ranked Poll / Tier List -->
    {% if poll.poll_type == "RANKED_POLL" %}
      {% include "results/ranked-poll.html" %}
    {% elif poll.poll_type == "TIER_LIST" %}
      {% include "results/tier-list.html" %}
    {% endif %} 
  
  </div>

  <div class="flex flex-row text-sm px-4 items-center my-4 select-none fade-in">
    <p class="font-light">
      Votes: {{ poll.response_count }}
    </p>

    {% set inFeed = session.state.tab == "feed" %}

    <!-- Show Results -->
    <button
      class="{% if not inFeed %} hidden {% endif %}  ml-auto px-2 h-6 md:h-8 rounded-xl text-sm bg-polll-blue hover:bg-polll-dgreen dark:hover:bg-polll-green flex items-center justify-center select-none text-neutral-900"
      hx-get="{{ url_for('poll.result', poll_id = poll.id) }}"
      hx-target="#poll-graph-{{ poll.id }}"
      hx-swap="none"
    >
      <span id="graph-toggle-{{ poll.id }}" class="graph-toggle hidden">
        Show Results 
      </span>
      <i class="fa fa-chart-simple pl-2 pr-2 text-xs"></i>
    </button>

    <!-- Show Results - Modal -->
      <a
      class="{% if inFeed %} hidden {% endif %} modal ml-auto px-2 h-6 md:h-8 rounded-xl text-sm bg-polll-blue hover:bg-polll-dgreen dark:hover:bg-polll-green flex items-center justify-center select-none text-neutral-900"
      hx-get="{{ url_for('poll.open_results', poll_id=id, username=session.user.username) }}"
      hx-target="#poll-content"
      hx-indicator="#loading-spinner"
      hx-swap="innerHTML"
      hx-on::after-request="open_poll_results();"
      >
        Show Poll
        <i class="fa fa-chart-simple px-2 text-xs"></i>
      </a>
     

  </div>

  <div class="poll-comments px-4 py-4 hidden" id="poll-comments-{{ poll.id }}">

    {% include "results/poll-comments.html" %}

  </div>

</div>
